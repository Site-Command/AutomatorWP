(function($){$('.automatorwp-selector select').each(function(){automatorwp_selector($(this))});$('.automatorwp-post-selector select').each(function(){automatorwp_post_selector($(this))});$('.automatorwp-term-selector select').each(function(){automatorwp_term_selector($(this))});$('.automatorwp-user-selector select').each(function(){automatorwp_user_selector($(this))});$('.automatorwp-object-selector select').each(function(){automatorwp_object_selector($(this))});$('.automatorwp-ajax-selector select').each(function(){automatorwp_ajax_selector($(this))});automatorwp_update_items_position($('.automatorwp-automation-items.automatorwp-triggers'));automatorwp_update_items_position($('.automatorwp-automation-items.automatorwp-actions'));$('body').on('click','.automatorwp-save-and-activate input',function(e){e.preventDefault();$('select#status').val('active');$('#ct-save').trigger('click')});$('body').on('mouseover','.automatorwp-tooltip',function(e){$(this).prev('.cmb2-metabox-description').addClass('automatorwp-tooltip-dialog').fadeIn('fast')});$('body').on('mouseout','.automatorwp-tooltip',function(e){$(this).prev('.cmb2-metabox-description').fadeOut('fast')});$('.automatorwp-automation-items').sortable({cursor:'grabbing',cancel:'.automatorwp-option-form-container, .automatorwp-no-grab',update:function(e,ui){automatorwp_update_items_position($(e.target))}});$('body').on('change','input#sequential',function(e){if($(this).prop('checked')){$('.automatorwp-triggers .automatorwp-automation-item-position').show()}else{$('.automatorwp-triggers .automatorwp-automation-item-position').hide()}});$('body').on('click','.automatorwp-automation-item-action-delete',function(e){var item=$(this).closest('.automatorwp-automation-item');var items_list=$(this).closest('.automatorwp-automation-items');var item_type=item.hasClass('automatorwp-trigger')?'trigger':'action';var id=item.find('input.id').val();item.slideUp('fast',function(){item.remove();automatorwp_update_items_position(items_list)});$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_delete_automation_item',nonce:automatorwp_admin.nonce,id:id,item_type:item_type},success:function(response){if(response.success){if(item_type==='trigger'){$('.automatorwp-automation-tag-selector optgroup[data-id="'+id+'"]').remove()}}else{}},error:function(response){}})});$('body').on('click','.automatorwp-add-trigger, .automatorwp-add-action',function(e){e.preventDefault();var type=$(this).hasClass('automatorwp-add-trigger')?'trigger':'action';$('<div class="automatorwp-automation-item automatorwp-'+type+'" style="display: none;">'+$(this).closest('.inside').find('.automatorwp-add-item-form').html()+'</div>').appendTo('.automatorwp-'+type+'s').slideDown('fast')});$('body').on('click','.automatorwp-automation-item .automatorwp-integration',function(e){e.preventDefault();var item=$(this).closest('.automatorwp-automation-item');var select=item.find('.automatorwp-integration-choices[data-integration="'+$(this).data('integration')+'"]');item.find('.automatorwp-select-integration').hide();item.find('.automatorwp-automation-item-details .automatorwp-integration-icon').append('<img src="'+$(this).data('icon')+'" />');item.find('.automatorwp-automation-item-content').prepend('<div class="automatorwp-integration-label">'+$(this).data('label')+'</div>');select.show();item.find('.automatorwp-integration-choices-container').show();$('<div class="automatorwp-select2-dropdown-container"></div>').insertAfter(select);var dropdown_container=select.next('.automatorwp-select2-dropdown-container');select.automatorwp_select2({theme:'default automatorwp-select2',placeholder:select.data('placeholder'),allowClear:!1,multiple:!1,closeOnSelect:!1,dropdownParent:dropdown_container,escapeMarkup:function(markup){return markup},templateResult:function(data){var text=data.text;if(data.element!==undefined){var custom_text=$(data.element).data('text');if(custom_text!==undefined&&custom_text.length){text=custom_text}}
return text},templateSelection:function(data){return data.text}}).on('select2:open',function(e){dropdown_container.find('input.select2-search__field').attr('placeholder',select.data('placeholder'))}).on('select2:closing',function(e){e.preventDefault()}).on('select2:closed',function(e){select.select2('open')}).on('select2:selecting',function(e){if(select.prop('disabled')){e.preventDefault()}});select.automatorwp_select2('open')});$('body').on('change','.automatorwp-automation-item .automatorwp-integration-choices',function(e){e.preventDefault();if($(this).prop('disabled')){return}
var item=$(this).closest('.automatorwp-automation-item');var items_list=item.closest('.automatorwp-automation-items');var automation_id=$('#object_id').val();var type=$(this).val();var item_type=item.hasClass('automatorwp-trigger')?'trigger':'action';if(!type.length){return}
var last_position=items_list.find('.automatorwp-automation-item input.position').last();var position=0;if(last_position.length){position=parseInt(last_position.val())+1}else{position=parseInt(items_list.find('.automatorwp-automation-item').length-1)}
$(this).prop('disabled',!0);item.find('.automatorwp-spinner').show();$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_add_automation_item',nonce:automatorwp_admin.nonce,automation_id:automation_id,item_type:item_type,type:type,position:position},success:function(response){if(response.success){var new_item=$(response.data.edit_html);new_item.appendTo(item.closest('.automatorwp-automation-items'));if(item_type==='trigger'&&response.data.tags_html.length){$(response.data.tags_html).appendTo('.automatorwp-automation-tag-selector')}
item.remove();automatorwp_initialize_form_fields(new_item)}else{}},error:function(response){}})});$('body').on('click','.automatorwp-automation-item .automatorwp-cancel-choice-select',function(e){e.preventDefault();var item=$(this).closest('.automatorwp-automation-item');item.slideUp('fast',function(){item.remove()})});$('body').on('click','.automatorwp-automation-item-label > .automatorwp-option',function(e){var item=$(this).closest('.automatorwp-automation-item');var option=$(this).data('option');var option_form=item.find('.automatorwp-option-form-container[data-option="'+option+'"]');if(option_form.hasClass('automatorwp-option-form-active')){option_form.removeClass('automatorwp-option-form-active').slideUp('fast')}else{item.find('.automatorwp-option-form-active').removeClass('automatorwp-option-form-active').slideUp('fast');option_form.addClass('automatorwp-option-form-active').slideDown('fast')}});$('body').on('click','.automatorwp-save-option-form',function(e){var button=$(this);if(button.prop('disabled')){return}
var item=button.closest('.automatorwp-automation-item');var form=button.closest('.automatorwp-option-form-container');var id=item.find('input.id').val();var item_type=item.hasClass('automatorwp-trigger')?'trigger':'action';form.find('.automatorwp-spinner').show();button.prop('disabled',!0);button.next('.automatorwp-cancel-option-form').prop('disabled',!0);var data=automatorwp_get_option_form_values(form);data.action='automatorwp_update_item_option';data.nonce=automatorwp_admin.nonce;data.id=id;data.item_type=item_type;data.option_name=form.data('option');$.ajax({url:ajaxurl,method:'POST',data:data,success:function(response){if(response.success){form.removeClass('automatorwp-option-form-active').slideUp('fast');item.find('.automatorwp-automation-item-label').html(response.data.edit_html);if(item_type==='trigger'){$('.automatorwp-automation-tag-selector optgroup[data-id="'+id+'"]').attr('label',response.data.edit_html);if(response.data.tags_html.length){$('.automatorwp-automation-tag-selector optgroup[data-id="'+id+'"]').html($(response.data.tags_html).html());$('.automatorwp-automation-tag-selector').each(function(){$(this).automatorwp_select2('destroy');automatorwp_tags_selector($(this))})}}}
form.find('.automatorwp-spinner').hide();button.prop('disabled',!1);button.next('.automatorwp-cancel-option-form').prop('disabled',!1)},error:function(response){}})});$('body').on('click','.automatorwp-cancel-option-form',function(e){$(this).closest('.automatorwp-option-form-container').removeClass('automatorwp-option-form-active').slideUp('fast')});$('body').on('change','.automatorwp-option-form input[type="radio"]',function(e){$(this).closest('ul').find('input[type="radio"]:not([value="'+$(this).val()+'"])').prop('checked',!1)});$('body').on('click','.automatorwp-option-form input[type="radio"] + label',function(e){e.preventDefault();$(this).prev('input').prop('checked',!0).change()});$('body').on('click','.automatorwp-option-form input[type="checkbox"] + label',function(e){e.preventDefault();$(this).prev('input').prop('checked',(!$(this).prev('input').prop('checked'))).change()});$('.automatorwp-option-form .cmb-repeat-table').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).parent().find('.cmb-add-row-button').attr('data-selector',new_id)});$('.automatorwp-option-form .cmb-repeatable-group').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).find('.cmb-add-group-row').attr('data-selector',new_id);$(this).find('.cmb-remove-group-row').attr('data-selector',new_id)});$('body').on('cmb2_add_row','.cmb-repeatable-group',function(e,row,cmb){row.find('.select2').remove();row.find('.select2-hidden-accessible').removeClass('select2-hidden-accessible').removeAttr('data-select2-id');automatorwp_initialize_form_fields(row)});$('.automatorwp-automation-tag-selector').each(function(){automatorwp_tags_selector($(this))});$('body').on('focus','.automatorwp-action input, .automatorwp-action textarea',function(e){$(this).data('focused',!0)});$('body').on('change','.automatorwp-automation-tag-selector',function(e){var input=$(this).parent().find('input, textarea');var value=$(this).val();if(value&&value.length){value='{'+value+'}';if($(this).closest('.cmb-row').hasClass('cmb-type-wysiwyg')){input=$(this).parent().find('textarea.wp-editor-area');var editor=window.tinyMCE.get(input.attr('id'));if(editor&&!editor.isHidden()){editor.execCommand('mceInsertContent',!1,value);return}else if(typeof QTags!=='undefined'){QTags.insertContent(value);return}}
if(input.data('focused')!==!0){automatorwp_set_caret_at_end(input)}
automatorwp_insert_at_caret(input,value)}});$('body').on('click','.automatorwp-tags-select2 .select2-dropdown li[role="group"] > strong',function(e){$(this).next('ul').slideToggle('fast')})})(jQuery);function automatorwp_update_items_position(element){var $=$||jQuery;var items=element.find('.automatorwp-automation-item');var items_order={};var items_order_for_tags=[];items.each(function(index,value){$(this).find('input.position').val(index);$(this).find('.automatorwp-automation-item-position').html((index+1)+'.');items_order[$(this).find('input.id').val()]=index;items_order_for_tags.push($(this).find('input.id').val())});if(Object.entries(items_order).length){var item_type=element.hasClass('automatorwp-triggers')?'trigger':'action';$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_update_automation_items_order',nonce:automatorwp_admin.nonce,items_order:items_order,item_type:item_type,},success:function(response){if(response.success){}else{}},error:function(response){}});if(item_type==='trigger'){$.each(items_order_for_tags,function(index,id){$('.automatorwp-automation-tag-selector').each(function(){$(this).find('optgroup[data-id="'+id+'"]').appendTo(this)})})}}}
function automatorwp_tags_selector(element){var $=$||jQuery;element.automatorwp_select2({theme:'default automatorwp-select2 automatorwp-tags-select2',escapeMarkup:function(markup){return markup},templateResult:function(data){var text=data.text;if(data.element!==undefined){var label=$(data.element).attr('label');if(label!==undefined&&label.length){text=label}
var custom_text=$(data.element).data('text');if(custom_text!==undefined&&custom_text.length){text=custom_text}
var icon=$(data.element).data('icon');if(icon!==undefined){text='<img src="'+icon+'" />'+text}}
return text},matcher:automatorwp_select2_optgroup_matcher,dropdownPosition:'below',});element.val('').trigger('change')}
function automatorwp_get_option_form_values(form){var $=$||jQuery;var data={};form.find('input:not([type="button"]):not([type="submit"]), select, textarea').each(function(){var option=$(this).data('option');var value=$(this).val();if($(this).closest('.cmb-row.empty-row').length){return}
if($(this).attr('type')==='checkbox'||$(this).attr('type')==='radio'){if($(this).closest('.cmb2-checkbox-list').length){value=[];$(this).closest('.cmb2-checkbox-list').find('input:checked').each(function(){value.push($(this).val())})}else if(!$(this).prop('checked')){return}}else if($(this).hasClass('wp-editor-area')){option=$(this).attr('name');if(window.tinyMCE.editors.length&&window.tinyMCE.editors[$(this).attr('id')]){window.tinyMCE.editors[$(this).attr('id')].save();value=$(this).val()}}
if(option!==undefined){if(option.indexOf('[')!==-1){var parts=option.split('[');option=parts[0];if(data[option]===undefined){data[option]=[]}
if(parts[1]!==']'){var option_key=parts[1].replace(']','');var index=$(this).closest('.cmb-repeatable-grouping').data('iterator');if(data[option][index]===undefined){data[option][index]={}}
data[option][index][option_key]=value}else{data[option].push(value)}}else{data[option]=value}}});return data}
function automatorwp_initialize_form_fields(form){var $=$||jQuery;form.find('.automatorwp-selector select').each(function(){automatorwp_selector($(this))});form.find('.automatorwp-post-selector select').each(function(){automatorwp_post_selector($(this))});form.find('.automatorwp-term-selector select').each(function(){automatorwp_term_selector($(this))});form.find('.automatorwp-user-selector select').each(function(){automatorwp_user_selector($(this))});form.find('.automatorwp-object-selector select').each(function(){automatorwp_object_selector($(this))});form.find('.automatorwp-ajax-selector select').each(function(){automatorwp_ajax_selector($(this))});form.find('.automatorwp-automation-tag-selector').each(function(){automatorwp_tags_selector($(this))});form.find('.cmb-repeat-table').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).parent().find('.cmb-add-row-button').attr('data-selector',new_id)});form.find('.cmb-repeatable-group').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).find('.cmb-add-group-row').attr('data-selector',new_id);$(this).find('.cmb-remove-group-row').attr('data-selector',new_id)});form.on('click','.cmb-add-group-row',function(e){window.CMB2.addGroupRow.apply(this,[e])}).on('click','.cmb-add-row-button',function(e){window.CMB2.addAjaxRow.apply(this,[e])}).on('click','.cmb-remove-group-row',function(e){window.CMB2.removeGroupRow.apply(this,[e])}).on('click','.cmb-remove-row-button',function(e){window.CMB2.removeAjaxRow.apply(this,[e])}).on('cmb2_remove_row','.cmb-repeatable-group',function(e){window.CMB2.resetTitlesAndIterator.apply(this,[e])}).on('click','.cmbhandle, .cmbhandle + .cmbhandle-title',function(e){window.CMB2.toggleHandle.apply(this,[e])});form.find('.cmb-type-wysiwyg').each(function(){var $this=$(this);var textarea_id=$this.find('textarea').attr('id');var textarea=$this.find('textarea').clone();$this.find('.wp-editor-wrap').remove();$this.find('.cmb-td').append(textarea);wp.editor.initialize(textarea_id,{mediaButtons:!0,tinymce:{wpautop:!0,toolbar1:'formatselect bold italic bullist numlist blockquote alignleft aligncenter alignright link unlink wp_more fullscreen wp_adv',toolbar2:'strikethrough hr forecolor pastetext removeformat charmap outdent indent undo redo wp_help'},quicktags:{buttons:'strong,em,link,block,del,ins,img,ul,ol,li,,code,more,close'}})});if('undefined'!==typeof window.QTags){window.QTags._buttonsInit()}}